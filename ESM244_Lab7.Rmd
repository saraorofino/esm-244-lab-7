---
title: "ESM 244 Lab 7"
author: "Sara Orofino"
date: "2/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load Packages:

```{r, message = FALSE, warning=FALSE}

library(tidyverse)
library(tmap)
library(sf)
library(spatstat)
library(maptools)
library(sp)
library(raster)
library(gstat)


```


Part 1. Hawaii raster practice 

```{r}

hi_par <- raster("PAR_CLIM_M.tif")
plot(hi_par)

hi_sst <- raster("SST_LTM.tif")
plot(hi_sst)

hi_chl <- raster("CHL_LTM.tif")
plot(hi_chl)

# See all three plots side by side 
par(mfrow = c(1,3))
plot(hi_par)
plot(hi_sst)
plot(hi_chl)

# Note calling the raster in the console will tell you about the dimensions, rows, columns, number of cells, resolution, extent, and coordinate reference system

# Can use just hi_sst@crs to see the crs or hi_sst@extent to see the extent 
```


Reproject to WGS84:
```{r}

# Create character string to reference later on so you don't need to retype everytime 

wgs84 <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +no_defs"

hi_sst_84 <- projectRaster(hi_sst, crs = wgs84, method = "bilinear")

hi_sst_84@crs #check projection matches what you want 

```

raster::aggregate() for resampling
```{r}
# lower the resolution to make it more usable and take less time to load 

sst_rs <- aggregate(hi_sst, fact = 10)

```

Crop a raster:
```{r}

hi_sst_84@extent

# Create bounds to crop a raster - first decide on bounding box 
# Picked extent based on trial and error to isolate one island 

bounds <- as(extent(-156.2,-154.5,18.7,20.4),  "SpatialPolygons")

# Assign a coorrdinate reference system to the polygon we created - since it doesn't have one we just match it to hi_sst_84 (if it already had one you would convert using projectRaster())

crs(bounds) <- crs(hi_sst_84)

# Now crop sst information to the created polygon

sst_crop <- crop(hi_sst_84, bounds)
plot(sst_crop)
```

Simple raster math:

Nonsensical variable called "tropicality" that is the sum of PAR + SST + 2*ChlA, and we want to map that variable...

Note: for thematic (categorical) raster data, consider using method = "ngm" --> nearest neighbor approach
```{r}

# First reproject the other two rasters so all match up 

hi_par_84 <- projectRaster(hi_par, crs = wgs84, method = "bilinear")

hi_chl_84 <- projectRaster(hi_chl, crs = wgs84, method = "bilinear")

# Pay attention to the scales - see what seems reasonable given the scales to expect for an answer
```


```{r}

trop <- hi_par_84 + hi_sst_84 + 2*hi_chl_84

# Only returning objects where spatial data is present for all of them (intersections)

plot(trop)

# Notice the scale of 70-80 is what we expect given the scales of the inputs 
```

Now let's try and look at something using tmap:

```{r}
# Give R the folder in the working directory using dsn()

islands <- read_sf(dsn = "islands", layer = "Island_boundaries") %>% 
  dplyr::select(Island) %>% 
  st_simplify(dTolerance = 10) %>% 
  st_transform(crs = 4326)

plot(islands)
```

```{r}
#Set tmap to static plotting:
tmap_mode("plot")

# Note: remember tmap_mode("View") is interactive plotting

sst_map <- tm_shape(hi_sst_84) +
  tm_raster(title = "Mean Sea Surface Temperature") +
  tm_layout(bg.color = "navyblue",
            legend.position = c("left", "bottom"),
            legend.text.color = "white",
            legend.text.size = 0.5) +
  tm_shape(islands) +
  tm_fill("darkgreen")

# To save map files as png:

tmap_save(sst_map, "sara_hawaii.png", height = 5)
```






